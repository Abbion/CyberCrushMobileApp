[gd_scene load_steps=4 format=3 uid="uid://dfie8i6cij8t7"]

[ext_resource type="PackedScene" uid="uid://b33lb6oqou8we" path="res://scenes/custom_controlls/chat_message_board.tscn" id="1_nvn48"]
[ext_resource type="PackedScene" uid="uid://cshv3dqh1nyxj" path="res://scenes/custom_controlls/chat_list.tscn" id="2_ke17o"]

[sub_resource type="GDScript" id="GDScript_nvn48"]
script/source = "extends Control

@onready var chat_list: Control = $chat_list
@export var message_board: PackedScene
const message_board_name = \"message_board\"

func _ready() -> void:
	GlobalSignals.new_chat_created.connect(on_chat_created)
	GlobalSignals.close_chat_board.connect(on_chat_closed)

func open_chat(chat_id: int) -> void:
	var chat_message_board = message_board.instantiate()
	chat_message_board.name = message_board_name
	chat_message_board.hide()
	add_child(chat_message_board)
	await chat_message_board.load_chat_at_id(chat_id);
	chat_message_board.show()
	chat_list.hide()

func _on_chat_list_open_chat(chat_id: int) -> void:
	open_chat(chat_id)

func on_chat_closed() -> void:
	chat_list.refresh_chat_list()
	chat_list.show()
	remove_message_board()

func on_chat_created(chat_id: int) -> void:
	open_chat(chat_id)
	chat_list.refresh_chat_list()
	chat_list.reset_layout()

func remove_message_board() -> void:
	for child in get_children():
		if child.name == message_board_name:
			remove_child(child)
			child.queue_free()
			break
"

[node name="chat_panel" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_nvn48")
message_board = ExtResource("1_nvn48")

[node name="chat_list" parent="." instance=ExtResource("2_ke17o")]
layout_mode = 1

[connection signal="open_chat" from="chat_list" to="." method="_on_chat_list_open_chat"]
